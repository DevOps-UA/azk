{"version":3,"file":"agent.js","sources":["../../../src/cmds/agent.js","@traceur/generated/TemplateParser/4","@traceur/generated/TemplateParser/0","src/cmds/agent.js","@traceur/generated/TemplateParser/8","@traceur/generated/TemplateParser/7","@traceur/generated/TemplateParser/10","@traceur/generated/TemplateParser/9","@traceur/generated/TemplateParser/19","@traceur/generated/TemplateParser/11","@traceur/generated/TemplateParser/18","@traceur/generated/TemplateParser/14","@traceur/generated/TemplateParser/15","@traceur/generated/TemplateParser/12","@traceur/generated/TemplateParser/13","@traceur/generated/TemplateParser/16","@traceur/generated/TemplateParser/17","@traceur/generated/TemplateParser/3","@traceur/generated/TemplateParser/1","@traceur/generated/TemplateParser/2","@traceur/generated/TemplateParser/5"],"names":[],"mappings":"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","sourcesContent":["module.exports = function() {\n            $__placeholder__0\n          }.call($__placeholder__1);","var __moduleName = $__placeholder__0;","require($__placeholder__0)","import { _, fs, config, async, set_config, dynamic } from 'azk';\nimport { Command, Helpers } from 'azk/cli/command';\nimport { AGENT_CODE_ERROR } from 'azk/utils/errors';\n\ndynamic(this, {\n  Client() {\n    return require('azk/agent/client').Client;\n  },\n\n  Configure() {\n    return require('azk/agent/configure').Configure;\n  },\n});\n\nclass Cmd extends Command {\n  action(opts) {\n    var progress = Helpers.vmStartProgress(this);\n\n    return async(this, function* () {\n      // Only in start\n      if (opts.action === 'start') {\n        // And no running\n        var status = yield Client.status();\n        if (!status.agent) {\n          // Check and load configures\n          opts.configs = yield this.configure();\n\n          // Remove and adding vm (to refresh vm configs)\n          if (config('agent:requires_vm') && opts['reload-vm']) {\n            var cmd_vm = this.parent.commands.vm;\n            yield cmd_vm.action({ action: 'remove', fail: () => {} });\n          }\n        }\n      }\n\n      // Call action in agent\n      var promise = Client[opts.action](opts).progress(progress);\n      return promise.then((result) => {\n        if (opts.action != \"status\") return result;\n        return (result.agent) ? 0 : 1;\n      });\n    });\n  }\n\n  configure() {\n    this.warning('status.agent.wait');\n    var conf = new Configure(this);\n    this.ok('configure.loading_checking');\n    return conf.run().then((configs) => {\n      this.ok('configure.loaded');\n      return configs;\n    });\n  }\n}\n\nexport function init(cli) {\n  var cli = (new Cmd('agent {action}', cli))\n    .setOptions('action', { options: ['start', 'status', 'stop'] })\n    .addOption(['--daemon', '-d'], { default: true });\n\n  if (config('agent:requires_vm')) {\n    cli.addOption(['--reload-vm', '-d'], { default: true });\n  }\n}\n","var $__placeholder__0 = $__placeholder__1","$traceurRuntime.defaultSuperCall(this,\n                $__placeholder__0.prototype, arguments)","var $__placeholder__0 = $__placeholder__1","($traceurRuntime.createClass)($__placeholder__0, $__placeholder__1, $__placeholder__2,\n                                       $__placeholder__3)","return $__placeholder__0(\n            $__placeholder__1,\n            this);","$traceurRuntime.generatorWrap","function($ctx) {\n      while (true) $__placeholder__0\n    }","$ctx.state = ($__placeholder__0) ? $__placeholder__1 : $__placeholder__2;\n        break","return $__placeholder__0","$ctx.sent","$ctx.maybeThrow()","$ctx.returnValue = $__placeholder__0","return $ctx.end()","return $__placeholder__0","get $__placeholder__0() { return $__placeholder__1; }","__esModule: true","typeof global !== 'undefined' ? global : this"]}