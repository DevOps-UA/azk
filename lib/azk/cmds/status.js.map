{"version":3,"file":"status.js","sources":["../../../src/cmds/status.js","@traceur/generated/TemplateParser/4","@traceur/generated/TemplateParser/0","src/cmds/status.js","@traceur/generated/TemplateParser/8","@traceur/generated/TemplateParser/7","@traceur/generated/TemplateParser/10","@traceur/generated/TemplateParser/9","@traceur/generated/TemplateParser/17","@traceur/generated/TemplateParser/12","@traceur/generated/TemplateParser/16","@traceur/generated/TemplateParser/14","@traceur/generated/TemplateParser/13","@traceur/generated/TemplateParser/15","@traceur/generated/TemplateParser/11","@traceur/generated/TemplateParser/19","@traceur/generated/TemplateParser/18","@traceur/generated/TemplateParser/20","@traceur/generated/TemplateParser/3","@traceur/generated/TemplateParser/1","@traceur/generated/TemplateParser/2","@traceur/generated/TemplateParser/5"],"names":[],"mappings":"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","sourcesContent":["module.exports = function() {\n            $__placeholder__0\n          }.call($__placeholder__1);","var __moduleName = $__placeholder__0;","require($__placeholder__0)","import { log, _, async, config, t, dynamic } from 'azk';\nimport { Command, Helpers } from 'azk/cli/command';\nimport { SYSTEMS_CODE_ERROR, NotBeenImplementedError } from 'azk/utils/errors';\n\ndynamic(this, {\n  Manifest() {\n    return require('azk/manifest').Manifest;\n  },\n\n  moment() {\n    return require('moment');\n  }\n});\n\nclass Cmd extends Command {\n  action(opts) {\n    return async(this, function* () {\n      yield Helpers.requireAgent();\n\n      var manifest = new Manifest(this.cwd, true);\n      var systems  = manifest.getSystemsByName(opts.system);\n\n      yield Cmd.status(this, manifest, systems);\n    });\n  }\n\n  static status(cli, manifest, systems) {\n    return async(cli, function* () {\n      var columns = ['', 'System'.blue, 'Instancies'.green, 'Hostname'.yellow, 'Instances-Ports'.magenta, \"Provisioned\".cyan];\n      var table_status = this.table_add('table_status', { head: columns });\n\n      for (var system of systems) {\n        var instances = yield system.instances({ type: \"daemon\" });\n\n        if (system.balanceable && instances.length > 0) {\n          var hostname = system.url.underline;\n        } else {\n          var hostname = system.hostname;\n        }\n        var ports   = yield Cmd._ports_map(system, instances);\n        var name    = instances.length > 0 ? `${system.name}`.green : `${system.name}`.red;\n        var status  = instances.length > 0 ? `↑`.green : `↓`.red;\n        var counter = system.scalable ? instances.length.toString().blue : 'n/s'.red;\n\n        // Provisioned\n        var provisioned = system.provisioned;\n        provisioned = provisioned ? moment(provisioned).fromNow() : \"-\";\n\n        var line   = [status, name, counter, hostname, ports.join(', '), provisioned];\n        this.table_push(table_status, line);\n      }\n\n      this.table_show(table_status);\n    });\n  }\n\n  static _ports_map(system, instances) {\n    return async(function* () {\n      var instance, ports = [];\n\n      instances = _.clone(instances);\n      while(instance = instances.pop()) {\n        _.each(instance.NetworkSettings.Access, (port) => {\n          var name = system.portName(port.name);\n          ports.push(\n            `${instance.Annotations.azk.seq}-${name}:${port.port || \"n/m\".red}`\n          );\n        });\n      }\n\n      return _.isEmpty(ports) ? [\"-\"] : ports;\n    });\n  }\n}\n\nexport { Cmd };\nexport function init(cli) {\n  (new Cmd('status [system]', cli));\n}\n\n","var $__placeholder__0 = $__placeholder__1","$traceurRuntime.defaultSuperCall(this,\n                $__placeholder__0.prototype, arguments)","var $__placeholder__0 = $__placeholder__1","($traceurRuntime.createClass)($__placeholder__0, $__placeholder__1, $__placeholder__2,\n                                       $__placeholder__3)","return $__placeholder__0(\n            $__placeholder__1,\n            this);","$traceurRuntime.generatorWrap","function($ctx) {\n      while (true) $__placeholder__0\n    }","return $__placeholder__0","$ctx.maybeThrow()","return $ctx.end()","\n        for (var $__placeholder__0 =\n                 $__placeholder__1[Symbol.iterator](),\n                 $__placeholder__2;\n             !($__placeholder__3 = $__placeholder__4.next()).done; ) {\n          $__placeholder__5;\n          $__placeholder__6;\n        }","$ctx.state = ($__placeholder__0) ? $__placeholder__1 : $__placeholder__2;\n        break","$ctx.sent","$ctx.returnValue = $__placeholder__0","return $__placeholder__0","get $__placeholder__0() { return $__placeholder__1; }","__esModule: true","typeof global !== 'undefined' ? global : this"]}