{"version":3,"file":"scale.js","sources":["../../../src/cmds/scale.js","@traceur/generated/TemplateParser/4","@traceur/generated/TemplateParser/0","src/cmds/scale.js","@traceur/generated/TemplateParser/8","@traceur/generated/TemplateParser/7","@traceur/generated/TemplateParser/10","@traceur/generated/TemplateParser/9","@traceur/generated/TemplateParser/17","@traceur/generated/TemplateParser/12","@traceur/generated/TemplateParser/16","@traceur/generated/TemplateParser/14","@traceur/generated/TemplateParser/13","@traceur/generated/TemplateParser/15","@traceur/generated/TemplateParser/18","@traceur/generated/TemplateParser/11","@traceur/generated/TemplateParser/3","@traceur/generated/TemplateParser/1","@traceur/generated/TemplateParser/2","@traceur/generated/TemplateParser/5"],"names":[],"mappings":"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","sourcesContent":["module.exports = function() {\n            $__placeholder__0\n          }.call($__placeholder__1);","var __moduleName = $__placeholder__0;","require($__placeholder__0)","import { log, t, _, async, config, t, dynamic } from 'azk';\nimport { Command, Helpers } from 'azk/cli/command';\nimport { VerboseCmd } from 'azk/cli/verbose_cmd';\nimport { Cmd as StatusCmd } from 'azk/cmds/status';\n\ndynamic(this, {\n  Manifest() {\n    return require('azk/manifest').Manifest;\n  },\n});\n\nclass Cmd extends VerboseCmd {\n  action(opts) {\n    return async(this, function* () {\n      yield Helpers.requireAgent();\n\n      var manifest = new Manifest(this.cwd, true);\n      var systems  = manifest.getSystemsByName(opts.system);\n\n      yield this[`${this.name}`](manifest, systems, opts);\n\n      this.output(\"\");\n      yield StatusCmd.status(this, manifest, systems);\n    });\n  }\n\n  scale(manifest, systems, opts) {\n    return async(this, function* () {\n      for (var i = 0; i < systems.length; i++) {\n        var system = systems[i];\n        yield this._scale(system, parseInt(opts.to || 1), opts);\n      }\n    })\n  }\n\n  _formatAction(keys, event, system) {\n    this.images_checked = this.images_checked || {};\n\n    var data = { image: system.image.name };\n    if (event.action == \"check_image\") {\n      if (this.images_checked[data.image])\n        return null;\n      this.images_checked[data.image] = true;\n    }\n\n    this.ok([...keys, event.action], data);\n  }\n\n  _scale(system, instances = {}, opts) {\n    var progress = (event) => {\n      var pull_progress = Helpers.newPullProgress(this);\n      if (event.type == \"pull_msg\") {\n        pull_progress(event);\n      } else {\n        var keys = [\"commands\", \"scale\"];\n        switch(event.type) {\n          case \"action\":\n            this._formatAction(keys, event, system);\n            break;\n          case \"scale\":\n            event.instances = t([...keys, \"instances\"], event);\n            if (this.name != \"scale\") {\n              var type = event.from > event.to ? \"stopping\" : \"starting\";\n            } else {\n              var type = event.from > event.to ? \"scaling_down\" : \"scaling_up\";\n            }\n\n            this.ok([...keys, type], event);\n            break;\n          case \"wait_port\":\n          case \"provision\":\n            this.ok([...keys, event.type], event);\n            break;\n          default:\n            log.debug(event);\n        }\n      }\n    }\n\n    var options = {\n      provision_force: opts.reprovision || false,\n      remove: opts.remove,\n    };\n\n    this.verbose_msg(1, () => {\n      options = _.merge(options, {\n        provision_verbose: true,\n        stdout: this.stdout(),\n        stderr: this.stderr(),\n      });\n    });\n\n    return system.scale(instances, options).progress(progress);\n  }\n}\n\nexport { Cmd };\nexport function init(cli) {\n  (new Cmd('scale [system] [to]', cli))\n    .addOption(['--remove', '-r'], { default: true });\n}\n\n","var $__placeholder__0 = $__placeholder__1","$traceurRuntime.defaultSuperCall(this,\n                $__placeholder__0.prototype, arguments)","var $__placeholder__0 = $__placeholder__1","($traceurRuntime.createClass)($__placeholder__0, $__placeholder__1, $__placeholder__2,\n                                       $__placeholder__3)","return $__placeholder__0(\n            $__placeholder__1,\n            this);","$traceurRuntime.generatorWrap","function($ctx) {\n      while (true) $__placeholder__0\n    }","return $__placeholder__0","$ctx.maybeThrow()","return $ctx.end()","$ctx.state = ($__placeholder__0) ? $__placeholder__1 : $__placeholder__2;\n        break","$traceurRuntime.spread($__placeholder__0)","return $__placeholder__0","get $__placeholder__0() { return $__placeholder__1; }","__esModule: true","typeof global !== 'undefined' ? global : this"]}