{"version":3,"file":"scale.js","sources":["../../../src/cmds/scale.js","@traceur/generated/TemplateParser/4","@traceur/generated/TemplateParser/0","@traceur/generated/TemplateParser/7","@traceur/generated/TemplateParser/6","@traceur/generated/TemplateParser/9","@traceur/generated/TemplateParser/8","@traceur/generated/TemplateParser/18","@traceur/generated/TemplateParser/13","@traceur/generated/TemplateParser/17","@traceur/generated/TemplateParser/15","@traceur/generated/TemplateParser/14","@traceur/generated/TemplateParser/16","@traceur/generated/TemplateParser/10","@traceur/generated/TemplateParser/11","@traceur/generated/TemplateParser/12","@traceur/generated/TemplateParser/19","@traceur/generated/TemplateParser/5","@traceur/generated/TemplateParser/1","@traceur/generated/TemplateParser/2"],"names":[],"mappings":"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","sourcesContent":["import { log, _, async, config, t } from 'azk';\nimport { Command, Helpers } from 'azk/cli/command';\nimport { Manifest } from 'azk/manifest';\nimport { SYSTEMS_CODE_ERROR, NotBeenImplementedError } from 'azk/utils/errors';\nimport { Cmd as StatusCmd } from 'azk/cmds/status';\n\nclass Cmd extends Command {\n  action(opts) {\n    return async(this, function* () {\n      yield Helpers.requireAgent();\n\n      var manifest = new Manifest(this.cwd, true);\n      var systems  = Helpers.getSystemsByName(manifest, opts.system);\n\n      this.verbose_active = opts.verbose;\n      yield this[`${this.name}`](manifest, systems, opts);\n\n      this.output(\"\");\n      yield StatusCmd.status(this, manifest, systems);\n    });\n  }\n\n  verbose(...args) {\n    if (this.verbose_active) {\n      this.tOutput(...args);\n    }\n  }\n\n  _formatAction(keys, event, system) {\n    this.images_checked = this.images_checked || {};\n\n    var data = { image: system.image.name };\n    if (event.action == \"check_image\") {\n      if (this.images_checked[data.image])\n        return null;\n      this.images_checked[data.image] = true;\n    }\n\n    this.tOutput([...keys, event.action], data);\n  }\n\n  _scale(system, instances = {}, opts) {\n    var progress = (event) => {\n      var pull_progress = Helpers.newPullProgress(this);\n      if (event.type == \"pull_msg\") {\n        pull_progress(event);\n      } else {\n        var keys = [\"commands\", \"scale\"];\n        switch(event.type) {\n          case \"action\":\n            this._formatAction(keys, event, system);\n            break;\n          case \"scale\":\n          case \"provision\":\n            this.tOutput([...keys, event.type], event);\n            break;\n          default:\n            log.debug(event);\n        }\n      }\n    }\n\n    return system.scale(instances, { provision_force: opts.reprovision || false }).progress(progress);\n  }\n\n  scale(manifest, systems, opts) {\n    return async(this, function* () {\n      for (var i = 0; i < systems.length; i++) {\n        var system = systems[i];\n        yield this._scale(system, parseInt(opts.to || 1), opts);\n      }\n    })\n  }\n}\n\nexport { Cmd };\nexport function init(cli) {\n  (new Cmd('scale [system] [to]', cli))\n    .addOption(['--verbose', '-v'], { defaut: false })\n}\n\n","var __moduleName = $__placeholder__0;","require($__placeholder__0)","var $__placeholder__0 = $__placeholder__1","$traceurRuntime.defaultSuperCall(this,\n                $__placeholder__0.prototype, arguments)","var $__placeholder__0 = $__placeholder__1","($traceurRuntime.createClass)($__placeholder__0, $__placeholder__1, $__placeholder__2,\n                                       $__placeholder__3)","return $__placeholder__0(\n            $__placeholder__1,\n            this);","$traceurRuntime.generatorWrap","function($ctx) {\n      while (true) $__placeholder__0\n    }","return $__placeholder__0","$ctx.maybeThrow()","return $ctx.end()","\n            for (var $__placeholder__0 = [], $__placeholder__1 = 0;\n                 $__placeholder__2 < arguments.length; $__placeholder__3++)\n              $__placeholder__4[$__placeholder__5] = arguments[$__placeholder__6];","$traceurRuntime.toObject($__placeholder__0)","$traceurRuntime.spread($__placeholder__0)","$ctx.state = ($__placeholder__0) ? $__placeholder__1 : $__placeholder__2;\n        break","module.exports = $__placeholder__0;","get $__placeholder__0() { return $__placeholder__1; }","__esModule: true"]}