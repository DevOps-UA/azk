{"version":3,"file":"vm.js","sources":["../../../src/cmds/vm.js","@traceur/generated/TemplateParser/4","@traceur/generated/TemplateParser/0","src/cmds/vm.js","@traceur/generated/TemplateParser/7","@traceur/generated/TemplateParser/8","@traceur/generated/TemplateParser/9","@traceur/generated/TemplateParser/10","@traceur/generated/TemplateParser/17","@traceur/generated/TemplateParser/11","@traceur/generated/TemplateParser/16","@traceur/generated/TemplateParser/13","@traceur/generated/TemplateParser/12","@traceur/generated/TemplateParser/14","@traceur/generated/TemplateParser/15","@traceur/generated/TemplateParser/19","@traceur/generated/TemplateParser/18","@traceur/generated/TemplateParser/3","@traceur/generated/TemplateParser/1","@traceur/generated/TemplateParser/2","@traceur/generated/TemplateParser/5"],"names":[],"mappings":"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","sourcesContent":["module.exports = function() {\n            $__placeholder__0\n          }.call($__placeholder__1);","var __moduleName = $__placeholder__0;","require($__placeholder__0)","import { Q, _, config, async, t, dynamic } from 'azk';\nimport { Command, Helpers } from 'azk/cli/command';\nimport { net } from 'azk/utils';\n\ndynamic(this, {\n  VM() {\n    return require('azk/agent/vm').VM;\n  },\n\n  Server() {\n    return require('azk/agent/server').Server;\n  }\n});\n\nclass RequiredError extends Error {\n  constructor(key) {\n    this.key = key\n  }\n}\n\nclass VmCmd extends Command {\n  require_installed(vm_info) {\n    if (!vm_info.installed) {\n      throw new RequiredError(\"commands.vm.not_installed\");\n    }\n  }\n\n  require_running(vm_info) {\n    this.require_installed(vm_info);\n    if (!vm_info.running) {\n      throw new RequiredError(\"commands.vm.not_runnig\");\n    }\n  }\n\n  action(opts) {\n    if (!config('agent:requires_vm')) {\n      this.fail('commands.vm.not_requires');\n      return 1;\n    }\n\n    return async(this, function* () {\n      var action  = opts.action;\n      var vm_name = config(\"agent:vm:name\");\n      var vm_info = yield VM.info(vm_name);\n\n      var promise = this[`action_${action}`](vm_info);\n      promise = promise.progress(Helpers.vmStartProgress(this));\n\n      return promise.fail(opts.fail || ((error) => {\n        if (error instanceof RequiredError) {\n          this.fail(error.key);\n          return 1;\n        }\n        throw error;\n      }));\n    });\n  }\n\n  action_start(vm_info) {\n    return async(this, function* () {\n      if (vm_info.running) {\n        this.fail(\"commands.vm.already_running\");\n        return 1;\n      }\n      this.require_installed(vm_info);\n      yield Server.installVM(true, false);\n    });\n  }\n\n  action_stop(vm_info) {\n    return async(this, function* () {\n      this.require_running(vm_info);\n      yield VM.stop(vm_info.name);\n    });\n  }\n\n  action_status(vm_info) {\n    return async(this, function* () {\n      this.require_running(vm_info);\n      this.ok(\"commands.vm.running\");\n    });\n  }\n\n  action_installed(vm_info) {\n    return async(this, function* () {\n      this.require_installed(vm_info);\n      this.ok(\"commands.vm.already\");\n    });\n  }\n\n  action_install(vm_info) {\n    return async(this, function* () {\n      if (vm_info.installed) {\n        throw new RequiredError(\"commands.vm.already\");\n      }\n      yield Server.installVM(false, false);\n    });\n  }\n\n  action_remove(vm_info) {\n    return async(this, function* () {\n      this.require_installed(vm_info);\n      if (vm_info.running) {\n        yield VM.stop(vm_info.name);\n      }\n      yield VM.remove(vm_info.name);\n    });\n  }\n\n  action_reload(vm_info) {\n    return async(this, function* () {\n      this.require_installed(vm_info);\n\n      // Remove and install\n      yield this.action_remove(vm_info);\n      yield this.action_install({ installed: false });\n\n      if (vm_info.running) {\n        yield this.action_start({ installed: true, name: vm_info.name });\n      }\n    });\n  }\n}\n\nexport function init(cli) {\n  if (config('agent:requires_vm')) {\n    (new VmCmd('vm {action}', cli))\n      .setOptions('action', { options: ['install', 'installed', 'start', 'status', 'stop', 'remove', 'reload'] });\n  }\n}\n\n","var $__placeholder__0 = $__placeholder__1","($traceurRuntime.createClass)($__placeholder__0, $__placeholder__1, $__placeholder__2,\n                                       $__placeholder__3)","$traceurRuntime.defaultSuperCall(this,\n                $__placeholder__0.prototype, arguments)","var $__placeholder__0 = $__placeholder__1","return $__placeholder__0(\n            $__placeholder__1,\n            this);","$traceurRuntime.generatorWrap","function($ctx) {\n      while (true) $__placeholder__0\n    }","return $__placeholder__0","$ctx.sent","$ctx.returnValue = $__placeholder__0","return $ctx.end()","$ctx.state = ($__placeholder__0) ? $__placeholder__1 : $__placeholder__2;\n        break","$ctx.maybeThrow()","return $__placeholder__0","get $__placeholder__0() { return $__placeholder__1; }","__esModule: true","typeof global !== 'undefined' ? global : this"]}