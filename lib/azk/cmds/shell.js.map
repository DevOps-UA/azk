{"version":3,"file":"shell.js","sources":["../../../src/cmds/shell.js","@traceur/generated/TemplateParser/4","@traceur/generated/TemplateParser/0","@traceur/generated/TemplateParser/7","@traceur/generated/TemplateParser/6","@traceur/generated/TemplateParser/9","@traceur/generated/TemplateParser/8","@traceur/generated/TemplateParser/19","@traceur/generated/TemplateParser/11","@traceur/generated/TemplateParser/18","@traceur/generated/TemplateParser/10","@traceur/generated/TemplateParser/14","@traceur/generated/TemplateParser/12","@traceur/generated/TemplateParser/15","@traceur/generated/TemplateParser/16","@traceur/generated/TemplateParser/13","@traceur/generated/TemplateParser/17","@traceur/generated/TemplateParser/5","@traceur/generated/TemplateParser/1","@traceur/generated/TemplateParser/2"],"names":[],"mappings":"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","sourcesContent":["import { _, path, config, t, async } from 'azk';\nimport { Command, Helpers } from 'azk/cli/command';\nimport { Manifest } from 'azk/manifest';\n\nclass Cmd extends Command {\n  action(opts, extras) {\n    var progress = Helpers.newPullProgress(this);\n\n    return async(this, function* () {\n      var cmd = [opts.cmd, ...opts.__leftover];\n      var dir = this.cwd;\n      var env = {};\n\n      yield Helpers.requireAgent();\n\n      if (opts.image) {\n        // Arbitrary image\n        var manifest = Manifest.makeFake(dir, opts.image);\n        var system   = manifest.systemDefault;\n      } else {\n        var manifest = new Manifest(dir, true);\n        var system   = manifest.systemDefault;\n        if (opts.system) system = manifest.system(opts.system, true);\n      }\n\n      var tty_default = opts.t || !_.isString(opts.command)\n      var tty = (opts.T) ? (opts.t || false) : tty_default;\n\n      var options  = {\n        interactive: tty,\n        pull   : this.stdout(),\n        stdout : this.stdout(),\n        stderr : this.stderr(),\n        stdin  : this.stdin(),\n        workdir: opts.cwd || null,\n        volumes: {},\n        env: {},\n      }\n\n      for(var i = 0; i < opts.mount.length; i++) {\n        var point = opts.mount[i];\n        if (point.match(\".*:.*\")) {\n          point    = point.split(':')\n          point[0] = path.resolve(this.cwd, point[0]);\n          options.volumes[point[0]] = point[1];\n        } else {\n          this.fail('commands.shell.invalid_mount', { point });\n          return 1;\n        }\n      }\n\n      for(var j = 0; j < opts.env.length; j++) {\n        var variable = opts.env[i];\n        if (variable.match(\".*=.*\")) {\n          variable = variable.split('=')\n          options.env[variable[0]] = variable[1];\n        } else {\n          this.fail('commands.shell.invalid_env', { variable });\n          return 1;\n        }\n      }\n\n      var cmd = [opts.shell];\n      if (opts.command) {\n        cmd.push(\"-c\");\n        cmd.push(opts.command);\n      }\n\n      return yield system.exec(cmd, options);\n    }).progress(progress);\n  }\n}\n\nexport function init(cli) {\n  (new Cmd('shell', cli))\n    .addOption(['-T'])\n    .addOption(['-t'])\n    .addOption(['--system', '-s'], { type: String })\n    .addOption(['--image', '-i'], { type: String })\n    .addOption(['--command', '-c'], { type: String })\n    .addOption(['--shell'], { default: \"/bin/sh\", type: String })\n    .addOption(['--cwd', '-C'], { type: String })\n    .addOption(['--mount', '-m'], { type: String, acc: true, default: [] })\n    .addOption(['--env', '-e'], { type: String, acc: true, default: [] })\n    .addOption(['--verbose', '-v'])\n}\n","var __moduleName = $__placeholder__0;","require($__placeholder__0)","var $__placeholder__0 = $__placeholder__1","$traceurRuntime.defaultSuperCall(this,\n                $__placeholder__0.prototype, arguments)","var $__placeholder__0 = $__placeholder__1","($traceurRuntime.createClass)($__placeholder__0, $__placeholder__1, $__placeholder__2,\n                                       $__placeholder__3)","return $__placeholder__0(\n            $__placeholder__1,\n            this);","$traceurRuntime.generatorWrap","function($ctx) {\n      while (true) $__placeholder__0\n    }","$traceurRuntime.spread($__placeholder__0)","return $__placeholder__0","$ctx.maybeThrow()","$ctx.state = ($__placeholder__0) ? $__placeholder__1 : $__placeholder__2;\n        break","$ctx.returnValue = $__placeholder__0","$ctx.sent","return $ctx.end()","module.exports = $__placeholder__0;","get $__placeholder__0() { return $__placeholder__1; }","__esModule: true"]}