{"version":3,"file":"config.js","sources":["../../src/config.js","@traceur/generated/TemplateParser/4","@traceur/generated/TemplateParser/0","@traceur/generated/TemplateParser/6","@traceur/generated/TemplateParser/5","@traceur/generated/TemplateParser/1","@traceur/generated/TemplateParser/2"],"names":[],"mappings":"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","sourcesContent":["import { _, envs, mergeConfig } from 'azk/utils';\nvar path = require('path');\nvar os   = require('os');\n\n// Configs paths\nvar azk_root  = envs('AZK_ROOT_PATH');\nvar data_path = envs('AZK_DATA_PATH');\n\n// Namespace to support multiple instances of the agent\nvar namespace = envs('AZK_NAMESPACE');\n\n// Use virtual machine or not?\nvar default_vm  = os.platform() == \"linux\" ? \"false\" : \"true\";\nvar requires_vm = (envs('AZK_USE_VM', default_vm) == \"true\");\n\n// Persistent folder path\nvar persistent_folders = requires_vm ?\n  '/mnt/sda1/azk/persistent_folders' :\n  path.join(data_path, 'persistent_folders');\n\n// Paths to use in config\nvar paths = {\n  logs: path.join(data_path, 'logs'),\n  run : path.join(data_path, 'run'),\n  vm  : path.join(data_path, 'vm'),\n};\n\nvar options = mergeConfig({\n  '*': {\n    namespace: namespace,\n    manifest : \"Azkfile.js\",\n    locale   : 'en-US',\n    azk_dir  : \".azk\",\n    flags    : { show_deprecate: true, },\n    paths    : {\n      azk_root,\n      data: data_path,\n      logs: paths.logs,\n      log : path.join(paths.logs, 'azk.log'),\n\n      agent_pid         : path.join(paths.run, 'agent.pid'),\n      unfsd_pid         : path.join(paths.run, 'unfsd.pid'),\n      memcached_pid     : path.join(paths.run, 'memcachedjs.pid'),\n      hipache_pid       : path.join(paths.run, 'hipache.pid'),\n      agent_socket      : path.join(paths.run, 'agent.socket'),\n      unfsd_file        : path.join(paths.run, 'exports'),\n      balancer_file     : path.join(paths.run, 'hipache.json'),\n      memcached_socket  : path.join(paths.run, 'memcachedjs.socket'),\n      persistent_folders: persistent_folders,\n    },\n    logs_level: {\n      console: (envs('AZK_DEBUG') ? 'debug' : 'warn'),\n      file: envs('AZK_LOG_LEVEL', 'info'),\n    },\n    docker: {\n      //host          : docker_host,\n      namespace     : envs('AZK_NAMESPACE'),\n      repository    : 'azk',\n      default_domain: 'azk',\n      image_default : 'azukiapp/azktcl:0.0.2',\n      run: {\n        timeout: 1000,\n        retry: 10,\n      }\n    },\n    agent: {\n      requires_vm: requires_vm,\n      portrange_start: 11000,\n      balancer: {\n        ip  : \"from agent configure\",\n        host: envs('AZK_BALANCER_HOST'),\n        port: envs('AZK_BALANCER_PORT', 80),\n        file_dns: \"/etc/resolver/\" + envs('AZK_BALANCER_HOST'),\n      },\n      dns: {\n        ip  : \"from agent configure\",\n        port: envs('AZK_DNS_PORT', '53'),\n      },\n      vm: {\n        ip         : envs('AZK_AGENT_VM_IP'  , '192.168.50.4'),\n        name       : envs('AZK_AGENT_VM_NAME', \"azk-vm-\" + namespace),\n        user       : \"docker\",\n        password   : \"tcuser\",\n        cpus       : envs('AZK_VM_CPUS', os.cpus().length),\n        memory     : envs('AZK_VM_MEMORY', Math.floor(os.totalmem()/1024/1024/4)),\n        ssh_key    : envs('AZK_AGENT_VM_KEY'),\n        data_disk  : path.join(paths.vm, \"azk-agent.vmdk\"),\n        boot_disk  : path.join(env('AZK_LIB_PATH'), \"vm\", \"azk.iso\"),\n        blank_disk : path.join(env('AZK_LIB_PATH'), \"vm\", \"azk-agent.vmdk.bz\"),\n        mount_point: '/home/docker/files',\n        authorized_key: '/home/docker/.ssh/authorized_keys',\n      }\n    }\n  },\n  test: {\n    paths: {\n      log: path.join(data_path, 'logs', 'azk_test.log'),\n    },\n    docker: {\n      namespace   : 'azk.test',\n      repository  : 'azk-test',\n      image_empty : 'cevich/empty_base_image',\n    },\n    agent: {\n      portrange_start: 12000,\n      vm: {\n        data_disk : path.join(data_path, \"vm\", \"azk-agent-spec.vmdk\"),\n      }\n    }\n  }\n});\n\nfunction env() {\n  return envs('NODE_ENV', 'production');\n}\n\nexport function get(key) {\n  if (key == \"env\") return env();\n\n  var keys   = key.split(':');\n  var buffer = options[env()] || options['*'];\n\n  for(var i = 0; i < keys.length; i++) {\n    buffer = buffer[keys[i]];\n    if (!buffer) break;\n  }\n\n  return buffer;\n};\n\nexport function set(key, value) {\n  if (key == \"env\") {\n    process.env.NODE_ENV = value;\n  } else {\n    var keys   = [env(), ...key.split(':')];\n    var buffer = { [keys.pop()]: value };\n    while(key  = keys.pop()) { buffer = { [key]: buffer } };\n\n    // Check env exist\n    if (!options[env()]) {\n      options[env()] = _.cloneDeep(options['*']);\n    }\n\n    _.merge(options, buffer);\n  }\n  return value;\n}\n\n","var __moduleName = $__placeholder__0;","require($__placeholder__0)","$traceurRuntime.spread($__placeholder__0)","module.exports = $__placeholder__0;","get $__placeholder__0() { return $__placeholder__1; }","__esModule: true"]}