{"version":3,"file":"docker.js","sources":["../../../src/docker/docker.js","@traceur/generated/TemplateParser/4","@traceur/generated/TemplateParser/0","@traceur/generated/TemplateParser/7","@traceur/generated/TemplateParser/6","@traceur/generated/TemplateParser/9","@traceur/generated/TemplateParser/8","@traceur/generated/TemplateParser/11","@traceur/generated/TemplateParser/12","@traceur/generated/TemplateParser/10","@traceur/generated/TemplateParser/13","@traceur/generated/TemplateParser/5","@traceur/generated/TemplateParser/1","@traceur/generated/TemplateParser/2"],"names":[],"mappings":"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","sourcesContent":["import { Q, pp, config, path, _, log } from 'azk';\nimport Utils from 'azk/utils';\nimport { parseRepositoryTag } from 'dockerode/lib/util';\n\nvar uuid = require('node-uuid');\n\n// Composer\nimport { pull } from 'azk/docker/pull';\nimport { run  } from 'azk/docker/run';\n\nexport class Image extends Utils.qify('dockerode/lib/image') {\n  static parseRepositoryTag(...args) {\n    return parseRepositoryTag(...args);\n  }\n}\n\nexport class Container extends Utils.qify('dockerode/lib/container') {\n  static generateName(ns) {\n    var id = uuid.v1().replace(/-/g, \"\").slice(0, 10);\n    return `${config('docker:namespace')}-${ns}-id.${id}`;\n  }\n}\n\nexport class Docker extends Utils.qify('dockerode') {\n  constructor(opts) {\n    log.info(\"Connect %s:%s\", opts.host, opts.port);\n    super(opts);\n  }\n\n  getImage(name) {\n    return new Image(this.modem, name);\n  }\n\n  getContainer(id) {\n    return new Container(this.modem, id);\n  }\n\n  __findObj(obj) {\n    return obj.inspect().then(\n      (_data) => { return obj; },\n      (err  ) => {\n        if (err.statusCode == 404)\n          return null;\n        throw err;\n      }\n    );\n  }\n\n  findImage(name) {\n    return this.__findObj(this.getImage(name));\n  }\n\n  findContainer(id) {\n    return this.__findObj(this.getContainer(id));\n  }\n\n  pull(...args) {\n    return pull(this, ...args);\n  }\n\n  run(...args) {\n    return run(this, Container, ...args);\n  }\n\n  // TODO: Add test\n  resolvePath(target) {\n    target = Utils.resolve(target);\n    if (config('agent:requires_vm')) {\n      target = path.join(config('agent:vm:mount_point'), target);\n    }\n\n    return target;\n  }\n}\n","var __moduleName = $__placeholder__0;","require($__placeholder__0)","var $__placeholder__0 = $__placeholder__1","$traceurRuntime.defaultSuperCall(this,\n                $__placeholder__0.prototype, arguments)","var $__placeholder__0 = $__placeholder__1","($traceurRuntime.createClass)($__placeholder__0, $__placeholder__1, $__placeholder__2,\n                                       $__placeholder__3)","\n            for (var $__placeholder__0 = [], $__placeholder__1 = 0;\n                 $__placeholder__2 < arguments.length; $__placeholder__3++)\n              $__placeholder__4[$__placeholder__5] = arguments[$__placeholder__6];","$traceurRuntime.toObject($__placeholder__0)","$traceurRuntime.superCall($__placeholder__0, $__placeholder__1, $__placeholder__2,\n                                   $__placeholder__3)","$traceurRuntime.spread($__placeholder__0)","module.exports = $__placeholder__0;","get $__placeholder__0() { return $__placeholder__1; }","__esModule: true"]}