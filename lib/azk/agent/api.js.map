{"version":3,"file":"api.js","sources":["../../../src/agent/api.js","@traceur/generated/TemplateParser/4","@traceur/generated/TemplateParser/0","@traceur/generated/TemplateParser/11","@traceur/generated/TemplateParser/6","@traceur/generated/TemplateParser/10","@traceur/generated/TemplateParser/8","@traceur/generated/TemplateParser/7","@traceur/generated/TemplateParser/9","@traceur/generated/TemplateParser/5","@traceur/generated/TemplateParser/1","@traceur/generated/TemplateParser/2"],"names":[],"mappings":"AAAA;ACAI,CAAJ,EAAI,CAAA,YAAY,kBAAoB,CAAC;UCArC,CAAA,OAAO,CFAoC,KAAK,CEAtB;;;;;;AFGtB,CAAJ,EAAI,CAAA,GAAG,EAAO,CAAA,OAAO,CAAC,SAAS,CAAC,CAAC;AAC7B,CAAJ,EAAI,CAAA,OAAO,EAAG,CAAA,OAAO,CAAC,SAAS,CAAC,CAAC;AAC7B,CAAJ,EAAI,CAAA,GAAG,EAAG,CAAA,OAAO,EAAE,CAAC;AAGhB,CAAJ,EAAI,CAAA,GAAG,EAAG;AACR,CAAA,OAAM,CAAE,KAAI;CAEZ,MAAK,CAAL,UAAM;AAEJ,CAAA,MAAG,IAAI,CAAC,UAAU,YAAG,GAAG,CAAE,CAAA,GAAG;AACvB,CAAJ,QAAI,CAAA,IAAI,EAAG,CAAA,MAAM,CAAC,mBAAmB,CAAC,CAAC;AACvC,CAAA,QAAG,KAAK,CAAC,CAAC,OAAO,CAAC,IAAI,YAAG,GAAG,CAAE,CAAA,GAAG,CAAK;AACpC,CAAA,UAAG,CAAC,GAAG,CAAC,EAAG,CAAA,MAAM,CAAC,GAAG,CAAC,CAAC;CACvB,aAAO,IAAG,CAAC;OACZ,EAAE,GAAE,CAAC,CAAC,CAAC;OACR,CAAC;GACJ;CAED,MAAK,CAAL,UAAM;CACJ,SAAO,CAAA,KAAK,CAAC,IAAI,WAAa;;CGvBlC,WAAO,CCAP,eAAe,cDAS,ACAK,CCA7B,SAAS,IAAI,CAAE;CACT,cAAO,IAAI;;;ALwBX,CAAA,iBAAI,MAAM,EAAE,CAAC;sBAGA,CAAA,MAAM,CAAC,kBAAkB,CAAC;;;;;CM5B7C,mBN6BY,CAAA,IAAI,aAAa,CAAC,MAAM,CAAC,CM7Bb;;ACAxB,CAAA,iBAAI,WAAW,EAAE,CAAA;;;;;CDAjB,mBN8BY,CAAA,IAAI,QAAQ,CAAC,MAAM,CAAC,CM9BR;;ACAxB,CAAA,iBAAI,WAAW,EAAE,CAAA;;;;CCAjB,mBAAO,CAAA,IAAI,IAAI,EAAE,CAAA;;CHCmB,MAC/B,CFAO,KAAI,CAAC,CAAC;MH6BZ,CAAC;GACJ;CAED,KAAI,CAAJ,UAAK,CAAE;CACL,SAAO,CAAA,CAAC,IAAI,OAAO,CAAC,EAAG,CAAA,CAAC,QAAQ,CAAC,IAAI,OAAO,CAAE,QAAO,CAAC,CAAA,CAAG,CAAA,CAAC,EAAE,CAAC;GAC9D;CAGD,aAAY,CAAZ,UAAa,MAAM;CACjB,SAAO,CAAA,GAAG,OACD,CAAC,MAAM,CAAC,KACV,WAAE,KAAK,CAAK;CACf,SAAI,KAAK;CAAE,aAAO,CAAA,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;CAAA,IACtC,EAAC,CAAC;GACN;CAED,QAAO,CAAP,UAAQ,MAAM;;CACZ,SAAO,CAAA,KAAK,WAAE,OAAO,CAAE,CAAA,MAAM;AAC3B,CAAA,gBAAW,EAAG,CAAA,GAAG,OAAO,CAAC,MAAM,YAAG,GAAG,CAAK;AACxC,CAAA,QAAC,GAAG,CAAC,EAAG,CAAA,MAAM,CAAC,GAAG,CAAC,CAAA,CAAG,CAAA,OAAO,EAAE,CAAC;OACjC,EAAC,CAAC;OACH,CAAC;GACJ;CACF,CAAA;;AStDD,CAAA,KAAM,QAAQ;CCAd,UAAwB;CAAE,cAAyB;GAAE;ACArD,CAAA,WAAU,CAAE,KAAI;CAAA,AFAkB,CAAC;CTyDnC","sourcesContent":["import { _, Q, defer, async, config } from 'azk';\n\n// Express load and init\nvar qfs     = require('q-io/fs');\nvar express = require('express');\nvar app = express();\n\n// Module\nvar Api = {\n  server: null,\n\n  mount() {\n    // Return configs from set by Configure\n    app.get('/configs', (req, res) => {\n      var keys = config('agent:config_keys');\n      res.json(_.reduce(keys, (acc, key) => {\n        acc[key] = config(key);\n        return acc;\n      }, {}));\n    });\n  },\n\n  start() {\n    return async(this, function* () {\n      // Mount entries points\n      this.mount();\n\n      // Listen in unix domain socket\n      var socket = config('paths:api_socket');\n      yield this._clearSocket(socket);\n      yield this._listen(socket);\n    });\n  },\n\n  stop() {\n    return (this.server) ? Q.ninvoke(this.server, \"close\") : Q();\n  },\n\n  // Remove socket if exist\n  _clearSocket(socket) {\n    return qfs\n      .exists(socket)\n      .then((exist) => {\n        if (exist) return qfs.remove(socket);\n      });\n  },\n\n  _listen(socket) {\n    return defer((resolve, reject) => {\n      this.server = app.listen(socket, (err) => {\n        (err) ? reject(err) : resolve();\n      });\n    });\n  }\n}\n\nexport { Api }\n","var __moduleName = $__placeholder__0;","require($__placeholder__0)","return $__placeholder__0(\n            $__placeholder__1,\n            this);","$traceurRuntime.generatorWrap","function($ctx) {\n      while (true) $__placeholder__0\n    }","return $__placeholder__0","$ctx.maybeThrow()","return $ctx.end()","module.exports = $__placeholder__0;","get $__placeholder__0() { return $__placeholder__1; }","__esModule: true"]}