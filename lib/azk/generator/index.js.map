{"version":3,"file":"index.js","sources":["../../../src/generator/index.js","@traceur/generated/TemplateParser/4","@traceur/generated/TemplateParser/0","@traceur/generated/TemplateParser/7","@traceur/generated/TemplateParser/5","@traceur/generated/TemplateParser/1","@traceur/generated/TemplateParser/2"],"names":[],"mappings":"AAAA;ACAI,CAAJ,EAAI,CAAA,YAAY,wBAAoB,CAAC;UCArC,CAAA,OAAO,CFAmB,KAAK,CEAL;;;UAA1B,CAAA,OAAO,CFCiC,qBAAqB,CEDnC;;;AFGtB,CAAJ,EAAI,CAAA,IAAI,EAAG,CAAA,OAAO,CAAC,MAAM,CAAC,CAAC;AACvB,CAAJ,EAAI,CAAA,IAAI,EAAG,CAAA,OAAO,CAAC,MAAM,CAAC,CAAC;AACvB,CAAJ,EAAI,CAAA,EAAE,EAAK,CAAA,OAAO,CAAC,IAAI,CAAC,CAAC;AACrB,CAAJ,EAAI,CAAA,UAAU,EAAG,CAAA,OAAO,CAAC,YAAY,CAAC,CAAC;AAEnC,CAAJ,EAAI,CAAA,QAAQ,EAAG,CAAA,IAAI,KAAK,CACtB,MAAM,CAAC,gBAAgB,CAAC,CAAE,MAAK,CAAE,QAAO,CAAE,qBAAoB,CAC/D,CAAC;AAEE,CAAJ,EAAI,CAAA,KAAK,EAAG;AACV,CAAA,QAAO,CAAI,GAAE;AACb,CAAA,SAAQ,CAAG,GAAE;AACb,CAAA,MAAK,CAAM,GAAE;CAAA,AACd,CAAC;AAEE,CAAJ,EAAI,CAAA,SAAS,EAAG;AACd,CAAA,eAAc,CAAd,eAAc;AACd,CAAA,QAAO,CAAE,MAAK;CAEd,KAAI,CAAJ,UAAK,GAAG;;AACN,CAAA,IAAC,KAAK,CAAC,IAAI,KAAK,CAAC,IAAI,KAAK,CAAC,GAAG,CAAE,UAAS,CAAC,CAAC,YAAG,IAAI,CAAK;AACjD,CAAJ,QAAI,CAAA,IAAI,EAAI,CAAA,OAAO,CAAC,IAAI,CAAC,QAAQ,GAAI,GAAE,CAAC;CACxC,SAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,IAAI,KAAK,CAAC,CAAC,CAAE;AACtC,CAAA,WAAI,KAAK,EAAG,CAAA,IAAI,SAAS,CAAC,IAAI,CAAE,MAAK,CAAC,CAAC;AACvC,CAAA,mBAAY,CAAC,IAAI,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;OACpC;CAAA,IACF,EAAC,CAAC;GACJ;CAED,KAAI,CAAJ,UAAK,IAAI;CACP,SAAO,CAAA,CAAC,KAAK,CAAC,IAAI,MAAM,YAAG,IAAI,CAAK;CAAE,WAAO,CAAA,IAAI,KAAK,GAAI,KAAI,CAAA;KAAE,EAAC,CAAC;GACnE;CAED,IAAI,MAAK;CACP,SGrCJ,CAAA,eAAe,OAAO,CHqCP,IAAI,QAAQ,QAAQ,CAAK,CAAA,IAAI,QAAQ,SAAS,CAAK,CAAA,IAAI,QAAQ,MAAM,CGrC3C,CHqC6C;GACnF;CAED,YAAW,CAAX,UAAY,GAAG;CACb,SAAO,CAAA,CAAC,OAAO,CAAC,IAAI,MAAM,YAAG,OAAO,CAAE,CAAA,IAAI,CAAK;CAC7C,WAAO,CAAA,CAAC,MAAM,CAAC,OAAO,CAAE,CAAA,IAAI,YAAY,CAAC,GAAG,CAAE,QAAO,CAAC,CAAA,EAAI,GAAE,CAAC,CAAC;KAC/D,EAAE,GAAE,CAAC,CAAC;GACR;CAED,IAAI,IAAG,EAAG;CACR,OAAI,CAAC,IAAI,KAAK;AACZ,CAAA,SAAI,KAAK,EAAG,CAAA,UAAU,QAAQ,CAAC,EAAE,aAAa,CAAC,QAAQ,CAAC,SAAS,EAAE,CAAC,CAAC;AACvE,CADuE,SAChE,CAAA,IAAI,KAAK,CAAC;GAClB;CAED,OAAM,CAAN,UAAO,IAAI,CAAE,CAAA,IAAI,CAAE;AACjB,CAAA,OAAI,EAAG,CAAA,CAAC,OAAO,CAAC,CACd,IAAI,CAAE,GAAE,CACT,CAAE,KAAI,CAAC,CAAC;AACT,CAAA,KAAE,cAAc,CAAC,IAAI,CAAE,CAAA,IAAI,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;GACxC;CAAA,AACF,CAAA;CAED,OAAS,KAAI,CAAC,IAAI,CAAE;CAClB,OAAO,CAAA,IAAI,UAAU,CAAC,IAAI,GAAI,KAAI,CAAE,KAAI,CAAE,IAAG,CAAC,QACpC,CAAC,KAAK,CAAE,GAAE,CAAC,QACX,CAAC,WAAW,CAAE,KAAI,CAAC,CAAC;CAC/B;AAED,CAFC,OAEQ,SAAQ,CAAC,IAAI,CAAE;CACtB,OAAO,CAAA,IAAI,MAAM,CAAC,GAAG,CAAC,CAAA,GAAG,GAAI,EAAA,KAAI,EAAA,IAAG,GAAG,KAAI,CAAC;CAC7C;AAED,CAFC,SAES,eAAe,CAAC,MAAM,CAAE,KAAI,CAAC,CAAC;AACxC,CAAA,SAAU,eAAe,CAAC,UAAU,CAAE,SAAQ,CAAC,CAAC;AAGhD,CAAA,QAAS,KAAK,CAAC,IAAI,KAAK,CAAC,SAAS,CAAE,QAAO,CAAC,CAAC,CAAC;;AI1E9C,CAAA,KAAM,QAAQ;CCAd,gBAAwB;CAAE,oBAAyB;GAAE;CAArD,qBAAwB;CAAE,yBAAyB;GAAE;CAArD,YAAwB;CAAE,gBAAyB;GAAE;ACArD,CAAA,WAAU,CAAE,KAAI;CAAA,AFAkB,CAAC;CJ8EnC","sourcesContent":["import { _, config } from 'azk';\nimport { Helpers, example_system } from 'azk/generator/rules';\n\nvar glob = require('glob');\nvar path = require('path');\nvar fs   = require('fs');\nvar Handlebars = require('handlebars');\n\nvar template = path.join(\n  config('paths:azk_root'), 'src', 'share', 'Azkfile.mustach.js'\n);\n\nvar rules = {\n  runtime  : [],\n  database : [],\n  tasks    : [],\n};\n\nvar generator = {\n  example_system,\n  __rules: rules,\n\n  load(dir) {\n    _.each(glob.sync(path.join(dir, '**/*.js')), (file) => {\n      var rule  = require(file).default || {};\n      if (_.isArray(this.__rules[rule.type])) {\n        rule.name = path.basename(file, \".js\");\n        this.__rules[rule.type].push(rule);\n      }\n    });\n  },\n\n  rule(name) {\n    return _.find(this.rules, (rule) => { return rule.name == name });\n  },\n\n  get rules() {\n    return [...this.__rules.runtime, ...this.__rules.database, ...this.__rules.tasks];\n  },\n\n  findSystems(dir) {\n    return _.reduce(this.rules, (systems, rule) => {\n      return _.merge(systems, rule.findSystems(dir, systems) || {});\n    }, {});\n  },\n\n  get tpl() {\n    if (!this._tpl)\n      this._tpl = Handlebars.compile(fs.readFileSync(template).toString());\n    return this._tpl;\n  },\n\n  render(data, file) {\n    data = _.extend({\n      bins: [],\n    }, data);\n    fs.writeFileSync(file, this.tpl(data));\n  }\n}\n\nfunction json(data) {\n  return JSON.stringify(data || null, null, ' ')\n    .replace(/\\n/g, '')\n    .replace(/^(\\{|\\[) /, '$1');\n}\n\nfunction hash_key(data) {\n  return data.match(/-/) ? `'${data}'` : data;\n}\n\nHandlebars.registerHelper('json', json);\nHandlebars.registerHelper('hash_key', hash_key);\n\n// Load default rules\ngenerator.load(path.join(__dirname, \"rules\"));\n\nexport { generator, example_system, rules };\n\n","var __moduleName = $__placeholder__0;","require($__placeholder__0)","$traceurRuntime.spread($__placeholder__0)","module.exports = $__placeholder__0;","get $__placeholder__0() { return $__placeholder__1; }","__esModule: true"]}