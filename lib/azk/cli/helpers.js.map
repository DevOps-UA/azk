{"version":3,"file":"helpers.js","sources":["../../../src/cli/helpers.js","@traceur/generated/TemplateParser/4","@traceur/generated/TemplateParser/0","@traceur/generated/TemplateParser/6","@traceur/generated/TemplateParser/5","@traceur/generated/TemplateParser/1","@traceur/generated/TemplateParser/2"],"names":[],"mappings":"AAAA;ACAI,CAAJ,EAAI,CAAA,YAAY,oBAAoB,CAAC;UCArC,CAAA,OAAO,CFAgB,KAAK,CEAF;;;YAA1B,CAAA,OAAO,CFCgB,kBAAkB,CEDf;qBAA1B,CAAA,OAAO,CFEyB,kBAAkB,CEFxB;AFItB,CAAJ,EAAI,CAAA,KAAK,EAAG,CAAA,CAAC,CAAC,oCAAoC,CAAC,CAAC;AAChD,CAAJ,EAAI,CAAA,KAAK,EAAG,CAAA,CAAC,CAAC,kCAAkC,CAAC,CAAC;AAC9C,CAAJ,EAAI,CAAA,QAAQ,EAAG;AACX,CAAA,SAAQ,CAAE,IAAG;AACb,CAAA,WAAU,CAAE,IAAG;AACf,CAAA,MAAK,CAAE,GAAE;AACT,CAAA,MAAK,CAAE,IAAG;CAAA,AACb,CAAA;AAEG,CAAJ,EAAI,CAAA,OAAO,EAAG;CACZ,gBAAe,CAAf,UAAgB,GAAG;CACjB,oBAAQ,KAAK;CACX,SAAI,CAAC,KAAK;CAAE,cAAO;AAEf,CAFe,QAEf,CAAA,OAAO,EAAG,CAAA,KAAK,QAAQ,GAAI,QAAO,CAAA;AAClC,CAAJ,QAAI,CAAA,IAAI,EAAM,EAAC,QAAQ,CAAE,QAAO,CAAC,CAAC;CAElC,SAAI,KAAK,KAAK,GAAI,SAAQ,CAAE;CAE1B,eAAO,KAAK,OAAO;CACjB,aAAK,cAAa,CAAC;CACnB,aAAK,UAAS;AACZ,CAAA,cAAG,KAAK,CG1BpB,eAAe,OAAO,CH0BG,IAAI,GAAE,KAAK,OAAO,EG1BF,CH0BK,CAAA,KAAK,KAAK,CAAC,CAAC;CAC9C,iBAAM;AACR,CADQ,aACH,QAAO;AACV,CAAA,cAAG,KAAK,CG7BpB,eAAe,OAAO,CH6BG,IAAI,GAAE,KAAK,OAAO,EG7BF,CH6BK,MAAK,CAAC,CAAC;CACzC,iBAAM;AACR,CADQ;AAEN,CAAA,cAAG,GAAG,CGhClB,eAAe,OAAO,CHgCC,IAAI,GAAG,KAAK,OAAO,EGhCD,CHgCI,CAAA,KAAK,KAAK,CAAC,CAAC;CADvC,QAET;OACF,KAAM,KAAI,KAAK,KAAK,GAAI,cAAa,CAAE;AAClC,CAAJ,UAAI,CAAA,IAAI,EGnChB,CAAA,eAAe,OAAO,CHmCC,IAAI,GAAE,UAAU,EGnCE,AHmCD,CAAC;AACjC,CAAA,UAAG,OAAO,CAAC,IAAI,CAAE,MAAK,CAAC,CAAC;AACxB,CAAA,UAAG,GAAG,CAAC,IAAI,CAAE,MAAK,CAAC,CAAC;OACrB,KAAM;AACL,CAAA,UAAG,MAAM,CAAC,KAAK,CAAC,CAAC;OAClB;CAAA,MACD;GACH;CAED,aAAY,CAAZ,UAAa;CACX,SAAO,CAAA,MAAM,OAAO,EAAE,KAAK,WAAE,MAAM,CAAK;CACtC,SAAI,CAAC,MAAM,MAAM,CAAE;CACjB,YAAM,IAAI,gBAAe,EAAE,CAAC;OAC7B;CAAA,IACF,EAAC,CAAC;GACJ;CAED,gBAAe,CAAf,UAAgB,GAAG;AACb,CAAJ,MAAI,CAAA,KAAK,EAAG,CAAA,GAAG,aAAa,EAAE,CAAC;AAC3B,CAAJ,MAAI,CAAA,IAAI,EAAI,GAAE,CAAC;CAEf,oBAAQ,KAAK,CAAK;CAChB,SAAI,KAAK,KAAK,GAAI,WAAU,CAAA,EAAI,EAAC,KAAK,GAAG;CAAE,cAAO;AAE9C,CAF8C,QAE9C,CAAA,MAAM,EAAG,CAAA,KAAK,aAAa,CAAC;AAC5B,CAAJ,QAAI,CAAA,KAAK,IAAO,KAAK,GAAG,EAAA,IAAG,CAAA,CAAC;AACxB,CAAJ,QAAI,CAAA,GAAG,EAAM,CAAA,IAAI,CAAC,KAAK,GAAG,CAAC,GAAI,CAAA,GAAG,OAAO,CAAC,KAAK,CAAE,MAAK,CAAE,SAAQ,CAAC,CAAC;CAElE,aAAO,MAAM,KAAK;CAChB,WAAK,WAAU;AACT,CAAJ,YAAI,CAAA,QAAQ,EAAG,CAAA,KAAK,eAAe,CAAC;AAChC,CAAJ,YAAI,CAAA,IAAI,EAAO,CAAA,QAAQ,QAAQ,EAAG,CAAA,GAAG,KAAK,CAAC;AAC3C,CAAA,YAAG,MAAM,EAAM,CAAA,QAAQ,MAAM,EAAG,EAAC,CAAC;AAClC,CAAA,YAAG,KAAK,CAAC,IAAI,CAAE;AAAE,CAAA,gBAAK,CAAL,MAAK;AAAE,CAAA,mBAAQ,CAAE,CAAA,KAAK,SAAS;CAAA,UAAE,CAAC,CAAC;CACpD,eAAM;AACR,CADQ;AAEN,CAAA,YAAG,KAAK,CAAC,GAAG,KAAK,CAAE;AAAE,CAAA,gBAAK,CAAL,MAAK;AAAE,CAAA,cAAG,CAAE,MAAK;AAAE,CAAA,cAAG,CAAE,CAAA,KAAK,OAAO;CAAA,UAAE,CAAC,CAAC;CADvD,MAET;AAED,CAAA,SAAI,CAAC,KAAK,GAAG,CAAC,EAAG,IAAG,CAAC;KACtB,EAAA;GACF;CACF,CAAA;;AI7ED,CAAA,KAAM,QAAQ;CCAd,cAAwB;CAAE,kBAAyB;GAAE;ACArD,CAAA,WAAU,CAAE,KAAI;CAAA,AFAkB,CAAC;CJgFnC","sourcesContent":["import { t, log } from 'azk';\nimport { Client } from 'azk/agent/client';\nimport { AgentNotRunning } from 'azk/utils/errors';\n\nvar fmt_p = t('commands.helpers.pull.bar_progress');\nvar fmt_s = t('commands.helpers.pull.bar_status');\nvar bar_opts = {\n    complete: '='\n  , incomplete: ' '\n  , width: 30\n  , total: 100\n}\n\nvar Helpers = {\n  vmStartProgress(cmd) {\n    return (event) => {\n      if (!event) return;\n\n      var context = event.context || \"agent\"\n      var keys    = [\"status\", context];\n\n      if (event.type == \"status\") {\n        // running, starting, not_running, already\n        switch(event.status) {\n          case \"not_running\":\n          case \"already\":\n            cmd.fail([...keys, event.status], event.data);\n            break;\n          case \"error\":\n            cmd.fail([...keys, event.status], event);\n            break;\n          default:\n            cmd.ok([...keys,  event.status], event.data);\n        }\n      } else if (event.type == \"try_connect\") {\n        var tKey = [...keys, \"progress\"];\n        log.info_t(tKey, event);\n        cmd.ok(tKey, event);\n      } else {\n        log.debug(event);\n      }\n    };\n  },\n\n  requireAgent() {\n    return Client.status().then((status) => {\n      if (!status.agent) {\n        throw new AgentNotRunning();\n      }\n    });\n  },\n\n  newPullProgress(cmd) {\n    var mbars = cmd.newMultiBars();\n    var bars  = {};\n\n    return (event) => {\n      if (event.type != \"pull_msg\" || !event.id) return;\n\n      var status = event.statusParsed;\n      var title  = `${event.id}:`;\n      var bar    = bars[event.id] || cmd.newBar(mbars, fmt_p, bar_opts);\n\n      switch(status.type) {\n        case 'download':\n          var progress = event.progressDetail;\n          var tick     = progress.current - bar.curr;\n          bar.total    = progress.total + 1;\n          bar.tick(tick, { title, progress: event.progress });\n          break;\n        default:\n          bar.tick(bar.curr, { title, fmt: fmt_s, msg: event.status });\n      }\n\n      bars[event.id] = bar;\n    }\n  }\n}\n\nexport { Helpers };\n","var __moduleName = $__placeholder__0;","require($__placeholder__0)","$traceurRuntime.spread($__placeholder__0)","module.exports = $__placeholder__0;","get $__placeholder__0() { return $__placeholder__1; }","__esModule: true"]}