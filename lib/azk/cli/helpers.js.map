{"version":3,"file":"helpers.js","sources":["../../../src/cli/helpers.js","@traceur/generated/TemplateParser/4","@traceur/generated/TemplateParser/0","src/cli/helpers.js","@traceur/generated/TemplateParser/7","@traceur/generated/TemplateParser/3","@traceur/generated/TemplateParser/1","@traceur/generated/TemplateParser/2","@traceur/generated/TemplateParser/5"],"names":[],"mappings":"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","sourcesContent":["module.exports = function() {\n            $__placeholder__0\n          }.call($__placeholder__1);","var __moduleName = $__placeholder__0;","require($__placeholder__0)","import { _, t, log, dynamic } from 'azk';\nimport { AgentNotRunning } from 'azk/utils/errors';\n\nvar fmt_p = t('commands.helpers.pull.bar_progress');\nvar fmt_s = t('commands.helpers.pull.bar_status');\nvar bar_opts = {\n    complete: '='\n  , incomplete: ' '\n  , width: 30\n  , total: 100\n}\n\ndynamic(this, {\n  AgentClient() {\n    return require('azk/agent/client').Client;\n  },\n\n  Configure() {\n    return require('azk/agent/configure').Configure;\n  },\n});\n\nvar Helpers = {\n  requireAgent() {\n    return AgentClient.require();\n  },\n\n  configure(cli) {\n    cli.ok('configure.loading_checking');\n    return (new Configure(cli))\n      .run()\n      .then((configs) => {\n        cli.ok('configure.loaded');\n        return configs;\n      });\n  },\n\n  vmStartProgress(cmd) {\n    return (event) => {\n      if (!event) return;\n\n      var context = event.context || \"agent\"\n      var keys    = [\"status\", context];\n\n      switch(event.type) {\n        case \"status\":\n          // running, starting, not_running, already\n          switch(event.status) {\n            case \"not_running\":\n            case \"already\":\n              cmd.fail([...keys, event.status], event.data);\n              break;\n            case \"error\":\n              cmd.fail([...keys, event.status], event);\n              break;\n            default:\n              cmd.ok([...keys,  event.status], event.data);\n          }\n          break;\n        case \"try_connect\":\n          var tKey = [...keys, \"progress\"];\n          log.info_t(tKey, event);\n          cmd.ok(tKey, event);\n          break;\n        case \"ssh\":\n          if (context == \"stderr\")\n            break;\n        default:\n          log.debug(event);\n      }\n    };\n  },\n\n  newPullProgress(cmd) {\n    var mbars = cmd.newMultiBars();\n    var bars  = {};\n\n    return (event) => {\n      if (event.type != \"pull_msg\" || !event.id) return event;\n\n      var status = event.statusParsed;\n      var title  = `${event.id}:`;\n      var bar    = bars[event.id] || cmd.newBar(mbars, fmt_p, bar_opts);\n\n      switch(status.type) {\n        case 'download':\n          var progress = event.progressDetail;\n          var tick     = progress.current - bar.curr;\n          bar.total    = progress.total + 1;\n          bar.tick(tick, { title, progress: event.progress });\n          break;\n        default:\n          bar.tick(bar.curr, { title, fmt: fmt_s, msg: event.status });\n      }\n\n      bars[event.id] = bar;\n\n      return false;\n    }\n  },\n\n  escapeCapture(callback) {\n    // Escape sequence\n    var escapeBuffer = false;\n    var escape = false;\n\n    return (event) => {\n      if (event.type == \"stdin_pipe\") {\n        var stdin  = event.data[0].stdin;\n        var stream = event.data[0].stream;\n        var container = event.id;\n        var stopped = false;\n\n        stdin.on('data', function (key) {\n          if (stopped) return false;\n\n          var ch = key.toString(stdin.encoding || 'utf-8');\n\n          if (escapeBuffer && ch === '~') {\n            escapeBuffer = false;\n            escape = true;\n          } else if(ch === '\\r') {\n            escapeBuffer = true;\n            stream.write(key);\n          } else {\n            if (escape) {\n              stopped = callback(ch, container);\n              escape = false;\n            } else {\n              stream.write(key);\n            }\n            escapeBuffer = false;\n          }\n        });\n      }\n      return true;\n    }\n  }\n}\n\nexport { Helpers };\n","$traceurRuntime.spread($__placeholder__0)","return $__placeholder__0","get $__placeholder__0() { return $__placeholder__1; }","__esModule: true","typeof global !== 'undefined' ? global : this"]}