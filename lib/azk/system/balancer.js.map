{"version":3,"file":"balancer.js","sources":["../../../src/system/balancer.js","@traceur/generated/TemplateParser/4","@traceur/generated/TemplateParser/0","@traceur/generated/TemplateParser/11","@traceur/generated/TemplateParser/6","@traceur/generated/TemplateParser/10","@traceur/generated/TemplateParser/7","@traceur/generated/TemplateParser/8","@traceur/generated/TemplateParser/9","@traceur/generated/TemplateParser/13","@traceur/generated/TemplateParser/12","@traceur/generated/TemplateParser/5","@traceur/generated/TemplateParser/1","@traceur/generated/TemplateParser/2"],"names":[],"mappings":"AAAA;ACAI,CAAJ,EAAI,CAAA,YAAY,wBAAoB,CAAC;UCArC,CAAA,OAAO,CFAuB,KAAK,CEAT;;;cAA1B,CAAA,OAAO,CFCkB,oBAAoB,CEDnB;AFGtB,CAAJ,EAAI,CAAA,cAAc,EAAG;CACnB,MAAK,CAAL,UAAM,MAAM;CACV,SAAO,CAAA,KAAK,CAAC,IAAI,WAAY;CGLjC,WAAO,CCAP,eAAe,cDAS,ACAK,CCA7B,SAAS,IAAI,CAAE;CACT,cAAO,IAAI;;;ACDjB,CAAA,iBAAI,MAAM,EAAG,CAAA,CNMH,MAAM,YAAY,CMNI,QAAwC,CAAC;CACjE,mBAAK;;ACDb,CAAA,iBAAI,YAAY,EPOD,CAAA,QAAQ,UAAU,CAAC,MAAM,SAAS,COPb,APOc,COPd;;;;AAApC,CAAA,iBAAI,YAAY,EPSH,MOTuB,APSlB,COTkB;;;;CCApC,mBAAO,CAAA,IAAI,IAAI,EAAE,CAAA;;CHCmB,MAC/B,CFAO,KAAI,CAAC,CAAC;MHQZ,CAAC;GACJ;CAED,IAAG,CAAH,UAAI,MAAM,CAAE,CAAA,SAAS,CAAE;CACrB,SAAO,CAAA,IAAI,aAAa,CAAC,MAAM,CAAE,UAAS,CAAE,aAAY,CAAC,CAAC;GAC3D;CAED,OAAM,CAAN,UAAO,MAAM,CAAE,CAAA,SAAS,CAAE;CACxB,SAAO,CAAA,IAAI,aAAa,CAAC,MAAM,CAAE,UAAS,CAAE,gBAAe,CAAC,CAAC;GAC9D;CAED,KAAI,CAAJ,UAAK,MAAM,CAAE;CACX,OAAI,MAAM,YAAY,CAAE;CACtB,WAAO,CAAA,QAAQ,YAAY,CAAC,MAAM,SAAS,CAAC,CAAC;KAC9C,KAAM;CACL,WAAO,CAAA,CAAC,CAAC,EAAE,CAAC,CAAC;KACd;CAAA,EACF;CAED,aAAY,CAAZ,UAAa,MAAM,CAAE,CAAA,SAAS,CAAE,CAAA,MAAM;CACpC,SAAO,CAAA,KAAK,CAAC,IAAI,WAAa;;CG9BlC,WAAO,CCAP,eAAe,cDAS,ACAK,CCA7B,SAAS,IAAI,CAAE;CACT,cAAO,IAAI;;;ACDjB,CAAA,iBAAI,MAAM,EAAG,CAAA,CN+BH,MAAM,YAAY,CM/BI,QAAwC,CAAC;CACjE,mBAAK;;;CGDb,mBTgC4B,CAAA,SAAS,QAAQ,EAAE,CShCvB;;ATgChB,CAAA,sBAAS,EUhCjB,CAAA,IAAI,KAAK,AVgCsC,CAAA;;;;uBACzB,CAAA,IAAI,eAAe,CAAC,MAAM,CAAE,UAAS,CAAC;;;;AOjC5D,CAAA,iBAAI,YAAY,EPkCD,CAAA,QAAQ,CAAC,MAAM,CAAC,CAAC,MAAM,MAAM,CAAE,QAAO,COlCjB,APkCkB,COlClB;;;;AAApC,CAAA,iBAAI,YAAY,EPqCH,KOrCuB,APqCnB,COrCmB;;;;CCApC,mBAAO,CAAA,IAAI,IAAI,EAAE,CAAA;;CHCmB,MAC/B,CFAO,KAAI,CAAC,CAAC;MHoCZ,CAAC;GACJ;CAED,eAAc,CAAd,UAAe,MAAM,CAAE,CAAA,SAAS,CAAE;AAC5B,CAAJ,MAAI,CAAA,IAAI,EAAG,CAAA,SAAS,gBAAgB,OAAO,CAAC,MAAM,UAAU,CAAC,CAAC;CAC9D,WAAO,SAAU,EAAA,CAAA,MAAM,CAAC,aAAa,CAAC,CAAA,CAAA,IAAI,EAAA,CAAA,IAAI,KAAK,EAAG;GACvD;CAAA,AACF,CAAA;;;AW7CD,CAAA,KAAM,QAAQ;CCAd,qBAAwB;CAAE,yBAAyB;GAAE;CAArD,eAAwB;CAAE,yBAAyB;GAAE;ACArD,CAAA,WAAU,CAAE,KAAI;CAAA,AFAkB,CAAC;CXiDnC","sourcesContent":["import { async, config } from 'azk';\nimport { Balancer } from 'azk/agent/balancer';\n\nvar SystemBalancer = {\n  clear(system) {\n    return async(this, function*() {\n      if (system.balanceable) {\n        return Balancer.removeAll(system.hostname);\n      }\n      return false;\n    });\n  },\n\n  add(system, container) {\n    return this._addOrRemove(system, container, 'addBackend');\n  },\n\n  remove(system, container) {\n    return this._addOrRemove(system, container, 'removeBackend');\n  },\n\n  list(system) {\n    if (system.balanceable) {\n      return Balancer.getBackends(system.hostname);\n    } else {\n      return Q([]);\n    }\n  },\n\n  _addOrRemove(system, container, method) {\n    return async(this, function* () {\n      if (system.balanceable) {\n        container   = yield container.inspect();\n        var backend = this._formatBackend(system, container);\n        return Balancer[method](system.hosts, backend);\n      }\n\n      return null;\n    });\n  },\n\n  _formatBackend(system, container) {\n    var port = container.NetworkSettings.Access[system.http_port];\n    return `http://${config('agent:vm:ip')}:${port.port}`;\n  },\n}\n\nexport { SystemBalancer }\nexport { SystemBalancer as Balancer }\n","var __moduleName = $__placeholder__0;","require($__placeholder__0)","return $__placeholder__0(\n            $__placeholder__1,\n            this);","$traceurRuntime.generatorWrap","function($ctx) {\n      while (true) $__placeholder__0\n    }","$ctx.state = ($__placeholder__0) ? $__placeholder__1 : $__placeholder__2;\n        break","$ctx.returnValue = $__placeholder__0","return $ctx.end()","return $__placeholder__0","$ctx.sent","module.exports = $__placeholder__0;","get $__placeholder__0() { return $__placeholder__1; }","__esModule: true"]}